build:
  hello-world:
    context: .

  hello-world-dev:
    context: .
    target: dev

deploy:
  remote: true
  commands:
    - name: deploy chart
      command: |
        set -ex
        okteto pipeline deploy --repository https://github.com/okteto-community/hello-world-chart \
          --branch rb/cross-deploy \
          --var HELLO_WORLD_IMAGE_REPOSITORY="${OKTETO_BUILD_HELLO_WORLD_REGISTRY}/${OKTETO_BUILD_HELLO_WORLD_REPOSITORY}" \
          --var HELLO_WORLD_IMAGE_TAG=$OKTETO_BUILD_HELLO_WORLD_SHA
dev:
  hello-world:
    image: $OKTETO_BUILD_HELLO_WORLD_DEV_IMAGE
    sync:
      - .:/app
