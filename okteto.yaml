build:
  hello-world:
    context: .

  hello-world-dev:
    context: .
    target: dev

deploy:
  remote: true
  commands:
    - name: deploy chart
      command: |
        set -ex
        git clone https://github.com/okteto-community/hello-world-chart /tmp/hello-world-chart
        cd /tmp/hello-world-chart
        git checkout rb/no-deps
        cat okteto.yaml
        okteto deploy --var HELLO_WORLD_IMAGE_REPOSITORY="${OKTETO_BUILD_HELLO_WORLD_REGISTRY}/${OKTETO_BUILD_HELLO_WORLD_REPOSITORY}" --var HELLO_WORLD_IMAGE_TAG="${OKTETO_BUILD_HELLO_WORLD_SHA}"
dev:
  hello-world:
    image: $OKTETO_BUILD_HELLO_WORLD_DEV_IMAGE
    sync:
      - .:/app
